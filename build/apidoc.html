<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/inlight-media/gulp-asset"

    >gulp-asset (v0.0.8)</a>
</h1>
<h4>Gulp module for managing asset revisions and using multiple domains to server assets.</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.gulp-asset">module gulp-asset</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gulp-asset.config">
            function <span class="apidocSignatureSpan">gulp-asset.</span>config
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gulp-asset.replace">
            function <span class="apidocSignatureSpan">gulp-asset.</span>replace
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gulp-asset.rev">
            function <span class="apidocSignatureSpan">gulp-asset.</span>rev
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">gulp-asset.</span>version</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.gulp-asset.config">module gulp-asset.config</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gulp-asset.config.config">
            function <span class="apidocSignatureSpan">gulp-asset.</span>config
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.gulp-asset.replace">module gulp-asset.replace</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gulp-asset.replace.replace">
            function <span class="apidocSignatureSpan">gulp-asset.</span>replace
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.gulp-asset.rev">module gulp-asset.rev</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gulp-asset.rev.rev">
            function <span class="apidocSignatureSpan">gulp-asset.</span>rev
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.gulp-asset" id="apidoc.module.gulp-asset">module gulp-asset</a></h1>


    <h2>
        <a href="#apidoc.element.gulp-asset.config" id="apidoc.element.gulp-asset.config">
        function <span class="apidocSignatureSpan">gulp-asset.</span>config
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">config = function (opts) {
	defaults = _.defaults(opts, defaults);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	npm install --save-dev gulp-asset

## Usage

	var gulp = require(&#x27;gulp&#x27;);
	var asset = require(&#x27;gulp-asset&#x27;);

	asset.<span class="apidocCodeKeywordSpan">config</span>({
		prefix: [&#x27;http://cdn1.google.com&#x27;, &#x27;http://cdn2.google.com&#x27;]
	});

	gulp.task(&#x27;js&#x27;, function () {
		gulp.src(&#x27;src/assets/js/**/*.js&#x27;)
			.pipe(asset.rev())
			.pipe(asset.replace())
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gulp-asset.replace" id="apidoc.element.gulp-asset.replace">
        function <span class="apidocSignatureSpan">gulp-asset.</span>replace
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">replace = function () {
	var prefix = _.flatten([defaults.prefix]);
	var interval = defaults.interval;
	var assetPath = defaults.assetPath;

	return through.obj(function(file, enc, cb) {
		var newContents = file.contents;
		var _this = this;
		var completed = {};
		var repeats = 0;
		(function recurse() {
			var failed = repeats &#x3e;= defaults.repeat;

			// Find how many are files are still missing from the manifest,
			// if some are missing don&#x27;t continue, bypassing the regex should hopefully be a less expensive task
			if (!_.isEmpty(completed)) {
				var keys = _.keys(completed);
				var missing = 0;
				keys.forEach(function(key) {
					missing += typeof manifest[key] == &#x27;undefined&#x27;;
				});
				if (missing &#x3e; 0 &#x26;&#x26; !failed) {
					repeats++;
					setTimeout(recurse, interval);
					return;
				}
			}

			// If there are none missing then scan contents
			newContents = new Buffer(String(file.contents).replace(/\b((asset:\/\/?)[^#!%&#x26;*$?&#x27;&#x22;\s()&#x3c;&#x3e;]*(?:\([\w\d]*\)|([\.\w*]|\/)))/ig,
function(match) {
				// Replace placeholder with correct base
				var filepath = match.replace(&#x27;asset://&#x27;, assetPath);

				// Handle matches where it is just the base protocol to replace
				// Useful for your javascript expressions wher url is constructed using expression
				if (match == &#x27;asset://&#x27;) {
					return filepath;
				}

				// If manifest then return special manifest path
				if (filepath == path.join(assetPath, defaults.manifest)) {
					return prefix[0] + manifestFileName(opts);
				}

				completed[filepath] = false;

				// Check if file already in manifest, if it is, use it
				var found = manifest[filepath];

				// Else wait for it
				if (!found) {
					// @TODO: We could insert a 404 url in here if &#x22;failed&#x22; is true, probs not needed though
					return match;
				}
				// Get output filename and index for use in switching between prefixes
				var output = found.dest;
				completed[filepath] = true;
				return output;
			}));

			// If all matches have been completely replaced, finish, else recurse
			if (_.indexOf(_.values(completed), false) == -1 || failed) {
				if (failed) {
					var errored = _.compact(_.map(completed, function(val, key) { return !val ? gutil.colors.red(key): undefined }));
					var fileName = path.join(file.path.replace(file.cwd, &#x27;&#x27;).replace(defaults.src, defaults.dest));
					var message = gutil.colors.yellow(fileName) + &#x27;: Stalled or unable to process asset url: &#x27; + errored.join(&#x27;, &#x27;) + &#x27;. This can
 occur if the file doesn\&#x27;t exist or is very large and takes time to process. You can updated the &#x22;interval&#x22; option or the &#x22;repeats&#x22;.&#x27;;
					_this.emit(&#x27;error&#x27;, new gutil.PluginError(&#x27;gulp-asset&#x27;, message));
				}
				file.contents = newContents;
				_this.push(file);
				cb();
			} else {
				repeats++;
				setTimeout(recurse, interval);
			}
		})();
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	asset.config({
		prefix: [&#x27;http://cdn1.google.com&#x27;, &#x27;http://cdn2.google.com&#x27;]
	});

	gulp.task(&#x27;js&#x27;, function () {
		gulp.src(&#x27;src/assets/js/**/*.js&#x27;)
			.pipe(asset.rev())
			.pipe(asset.<span class="apidocCodeKeywordSpan">replace</span>())
			.pipe(gulp.dest(&#x27;dist/assets/js&#x27;));
	});

## Examples

Example JavaScript file
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gulp-asset.rev" id="apidoc.element.gulp-asset.rev">
        function <span class="apidocSignatureSpan">gulp-asset.</span>rev
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">rev = function (opts) {
	var opts = opts || {};
	var shouldHash = typeof opts.hash != &#x27;undefined&#x27; ? opts.hash : defaults.hash;
	var prefix = _.flatten([defaults.prefix]);
	var shouldPrefix = typeof opts.shouldPrefix != &#x27;undefined&#x27; ? opts.shouldPrefix : true;
	return through.obj(function(file, enc, cb) {
		var originalPath = file.path;

		// Get hash of contents
		var hash = md5(opts, file.contents.toString());

		// Construct new filename
		var ext = path.extname(file.path);
		var basePath = path.basename(file.path, ext);
		var filename = typeof hash !== &#x27;undefined&#x27; ? basePath + &#x27;-&#x27; + hash + ext : basePath + ext;
		file.path = path.join(path.dirname(file.path), filename);

		// Add to manifest
		var base = path.join(file.cwd, defaults.src);
		var key = originalPath.replace(base, &#x27;&#x27;);

		// @TODO: Instead of this it could use &#x22;glob&#x22; module to regex delete files
		// Check for existing value and whether cleanup is set
		var existing = manifest[key];
		if (existing &#x26;&#x26; existing.src &#x26;&#x26; defaults.cleanup) {
			// Delete the file
			fs.unlink(path.join(file.cwd, defaults.dest, existing.src));
		} else if (defaults.cleanup &#x26;&#x26; shouldHash) {
			// Check if cleanup and hash enabled then we can remove any non hashed version from dest directory
			var nonHashPath = path.join(path.dirname(originalPath), basePath + ext).replace(base, &#x27;&#x27;);
			var absPath = path.join(file.cwd, defaults.dest, nonHashPath);
			fs.exists(absPath, function(exists) {
				if (!exists) return;
				fs.unlink(absPath);
			});
		}

		var filePrefix = shouldPrefix ? prefix[index % prefix.length] : &#x27;&#x27;;

		// Finally add new value to manifest
		var src = file.path.replace(base, &#x27;&#x27;);
		manifest[key] = {
			index: index++,
			src: src,
			dest: filePrefix + src
		};

		// Write manifest file
		writeManifest();

		// Return and continue
		this.push(file);
		cb();
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

	asset.config({
		prefix: [&#x27;http://cdn1.google.com&#x27;, &#x27;http://cdn2.google.com&#x27;]
	});

	gulp.task(&#x27;js&#x27;, function () {
		gulp.src(&#x27;src/assets/js/**/*.js&#x27;)
			.pipe(asset.<span class="apidocCodeKeywordSpan">rev</span>())
			.pipe(asset.replace())
			.pipe(gulp.dest(&#x27;dist/assets/js&#x27;));
	});

## Examples

Example JavaScript file
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.gulp-asset.config" id="apidoc.module.gulp-asset.config">module gulp-asset.config</a></h1>


    <h2>
        <a href="#apidoc.element.gulp-asset.config.config" id="apidoc.element.gulp-asset.config.config">
        function <span class="apidocSignatureSpan">gulp-asset.</span>config
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">config = function (opts) {
	defaults = _.defaults(opts, defaults);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	npm install --save-dev gulp-asset

## Usage

	var gulp = require(&#x27;gulp&#x27;);
	var asset = require(&#x27;gulp-asset&#x27;);

	asset.<span class="apidocCodeKeywordSpan">config</span>({
		prefix: [&#x27;http://cdn1.google.com&#x27;, &#x27;http://cdn2.google.com&#x27;]
	});

	gulp.task(&#x27;js&#x27;, function () {
		gulp.src(&#x27;src/assets/js/**/*.js&#x27;)
			.pipe(asset.rev())
			.pipe(asset.replace())
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.gulp-asset.replace" id="apidoc.module.gulp-asset.replace">module gulp-asset.replace</a></h1>


    <h2>
        <a href="#apidoc.element.gulp-asset.replace.replace" id="apidoc.element.gulp-asset.replace.replace">
        function <span class="apidocSignatureSpan">gulp-asset.</span>replace
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">replace = function () {
	var prefix = _.flatten([defaults.prefix]);
	var interval = defaults.interval;
	var assetPath = defaults.assetPath;

	return through.obj(function(file, enc, cb) {
		var newContents = file.contents;
		var _this = this;
		var completed = {};
		var repeats = 0;
		(function recurse() {
			var failed = repeats &#x3e;= defaults.repeat;

			// Find how many are files are still missing from the manifest,
			// if some are missing don&#x27;t continue, bypassing the regex should hopefully be a less expensive task
			if (!_.isEmpty(completed)) {
				var keys = _.keys(completed);
				var missing = 0;
				keys.forEach(function(key) {
					missing += typeof manifest[key] == &#x27;undefined&#x27;;
				});
				if (missing &#x3e; 0 &#x26;&#x26; !failed) {
					repeats++;
					setTimeout(recurse, interval);
					return;
				}
			}

			// If there are none missing then scan contents
			newContents = new Buffer(String(file.contents).replace(/\b((asset:\/\/?)[^#!%&#x26;*$?&#x27;&#x22;\s()&#x3c;&#x3e;]*(?:\([\w\d]*\)|([\.\w*]|\/)))/ig,
function(match) {
				// Replace placeholder with correct base
				var filepath = match.replace(&#x27;asset://&#x27;, assetPath);

				// Handle matches where it is just the base protocol to replace
				// Useful for your javascript expressions wher url is constructed using expression
				if (match == &#x27;asset://&#x27;) {
					return filepath;
				}

				// If manifest then return special manifest path
				if (filepath == path.join(assetPath, defaults.manifest)) {
					return prefix[0] + manifestFileName(opts);
				}

				completed[filepath] = false;

				// Check if file already in manifest, if it is, use it
				var found = manifest[filepath];

				// Else wait for it
				if (!found) {
					// @TODO: We could insert a 404 url in here if &#x22;failed&#x22; is true, probs not needed though
					return match;
				}
				// Get output filename and index for use in switching between prefixes
				var output = found.dest;
				completed[filepath] = true;
				return output;
			}));

			// If all matches have been completely replaced, finish, else recurse
			if (_.indexOf(_.values(completed), false) == -1 || failed) {
				if (failed) {
					var errored = _.compact(_.map(completed, function(val, key) { return !val ? gutil.colors.red(key): undefined }));
					var fileName = path.join(file.path.replace(file.cwd, &#x27;&#x27;).replace(defaults.src, defaults.dest));
					var message = gutil.colors.yellow(fileName) + &#x27;: Stalled or unable to process asset url: &#x27; + errored.join(&#x27;, &#x27;) + &#x27;. This can
 occur if the file doesn\&#x27;t exist or is very large and takes time to process. You can updated the &#x22;interval&#x22; option or the &#x22;repeats&#x22;.&#x27;;
					_this.emit(&#x27;error&#x27;, new gutil.PluginError(&#x27;gulp-asset&#x27;, message));
				}
				file.contents = newContents;
				_this.push(file);
				cb();
			} else {
				repeats++;
				setTimeout(recurse, interval);
			}
		})();
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	asset.config({
		prefix: [&#x27;http://cdn1.google.com&#x27;, &#x27;http://cdn2.google.com&#x27;]
	});

	gulp.task(&#x27;js&#x27;, function () {
		gulp.src(&#x27;src/assets/js/**/*.js&#x27;)
			.pipe(asset.rev())
			.pipe(asset.<span class="apidocCodeKeywordSpan">replace</span>())
			.pipe(gulp.dest(&#x27;dist/assets/js&#x27;));
	});

## Examples

Example JavaScript file
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.gulp-asset.rev" id="apidoc.module.gulp-asset.rev">module gulp-asset.rev</a></h1>


    <h2>
        <a href="#apidoc.element.gulp-asset.rev.rev" id="apidoc.element.gulp-asset.rev.rev">
        function <span class="apidocSignatureSpan">gulp-asset.</span>rev
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">rev = function (opts) {
	var opts = opts || {};
	var shouldHash = typeof opts.hash != &#x27;undefined&#x27; ? opts.hash : defaults.hash;
	var prefix = _.flatten([defaults.prefix]);
	var shouldPrefix = typeof opts.shouldPrefix != &#x27;undefined&#x27; ? opts.shouldPrefix : true;
	return through.obj(function(file, enc, cb) {
		var originalPath = file.path;

		// Get hash of contents
		var hash = md5(opts, file.contents.toString());

		// Construct new filename
		var ext = path.extname(file.path);
		var basePath = path.basename(file.path, ext);
		var filename = typeof hash !== &#x27;undefined&#x27; ? basePath + &#x27;-&#x27; + hash + ext : basePath + ext;
		file.path = path.join(path.dirname(file.path), filename);

		// Add to manifest
		var base = path.join(file.cwd, defaults.src);
		var key = originalPath.replace(base, &#x27;&#x27;);

		// @TODO: Instead of this it could use &#x22;glob&#x22; module to regex delete files
		// Check for existing value and whether cleanup is set
		var existing = manifest[key];
		if (existing &#x26;&#x26; existing.src &#x26;&#x26; defaults.cleanup) {
			// Delete the file
			fs.unlink(path.join(file.cwd, defaults.dest, existing.src));
		} else if (defaults.cleanup &#x26;&#x26; shouldHash) {
			// Check if cleanup and hash enabled then we can remove any non hashed version from dest directory
			var nonHashPath = path.join(path.dirname(originalPath), basePath + ext).replace(base, &#x27;&#x27;);
			var absPath = path.join(file.cwd, defaults.dest, nonHashPath);
			fs.exists(absPath, function(exists) {
				if (!exists) return;
				fs.unlink(absPath);
			});
		}

		var filePrefix = shouldPrefix ? prefix[index % prefix.length] : &#x27;&#x27;;

		// Finally add new value to manifest
		var src = file.path.replace(base, &#x27;&#x27;);
		manifest[key] = {
			index: index++,
			src: src,
			dest: filePrefix + src
		};

		// Write manifest file
		writeManifest();

		// Return and continue
		this.push(file);
		cb();
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

	asset.config({
		prefix: [&#x27;http://cdn1.google.com&#x27;, &#x27;http://cdn2.google.com&#x27;]
	});

	gulp.task(&#x27;js&#x27;, function () {
		gulp.src(&#x27;src/assets/js/**/*.js&#x27;)
			.pipe(asset.<span class="apidocCodeKeywordSpan">rev</span>())
			.pipe(asset.replace())
			.pipe(gulp.dest(&#x27;dist/assets/js&#x27;));
	});

## Examples

Example JavaScript file
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
